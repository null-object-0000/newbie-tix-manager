import{d as j,r as p,q as Q,g as G,h as H,m as J,M as f,f as K,c as L,a as t,w as n,b as s,e as y,n as k,t as W,v as X,o as Y,_ as Z}from"./index-BS8JmWLW.js";import{b as ee,i as te,a as ae,j as ne,k as oe,l as le}from"./localStorage-5GgEftBe.js";import{a as se}from"./constants-YvDzxIri.js";const re={class:"performance-tickets"},ie={class:"info-content"},ue={class:"performance-info"},ce={class:"performance-cover"},de=["src"],me={class:"performance-details"},pe={class:"session-info"},fe=j({__name:"PerformanceTickets",setup(_e){const _=J(),D=K(),c=p(null),d=p(null),S=Q(()=>c.value?[{label:"演出标题",value:c.value.title},{label:"演出场馆",value:c.value.venue},{label:"演出状态",value:se[c.value.status]}]:[]),q=Q(()=>!c.value||!d.value?[]:[{label:"场次标题",value:d.value.title||"无"},{label:"售卖时间",value:`${I(d.value.startSaleTime)} - ${I(d.value.endSaleTime)}`},{label:"演出时间",value:`${I(d.value.startShowTime)} - ${I(d.value.endShowTime)}`}]),w=p(!1),m=p([]),T=p(!1),x=p(),v=p(null),o=G({name:"",price:0,totalQuantity:0}),M={name:[{required:!0,message:"请输入票档名称"}],price:[{required:!0,message:"请输入票价"}],totalQuantity:[{required:!0,message:"请输入总票数"}]};H(()=>{const a=Number(_.params.performanceId),e=Number(_.params.sessionId);if(a&&e){const i=ee(a),r=te(a,e);i&&r?(c.value=i,d.value=r,w.value=!0,m.value=ae(a,e),w.value=!1):(f.error("场次不存在"),D.push("/performances"))}});const P=()=>{v.value=null,o.name="",o.price=0,o.totalQuantity=0,T.value=!0},R=a=>{v.value=a,o.name=a.name,o.price=a.price,o.totalQuantity=a.totalQuantity,T.value=!0},U=async a=>{if(x.value)try{const e=await x.value.validate();if(e)return console.error("表单验证失败:",e),a(!1);const i=Number(_.params.performanceId),r=Number(_.params.sessionId),h={name:o.name,price:o.price,totalQuantity:o.totalQuantity};if(v.value){const b=oe(i,r,v.value.id,h);if(b){const g=m.value.findIndex(C=>{var u;return C.id===((u=v.value)==null?void 0:u.id)});return g!==-1&&(m.value[g]=b),f.success("更新成功"),a(!0)}}else{const b=le(i,r,h);return m.value.push(b),f.success("创建成功"),a(!0)}return f.error("操作失败"),a(!1)}catch(e){return console.error("表单验证失败:",e),f.error("请填写必填项"),a(!1)}},$=a=>{X.warning({title:"确认删除",content:"确定要删除该票档吗？",hideCancel:!1,onOk:()=>{const e=Number(_.params.performanceId),i=Number(_.params.sessionId);ne(e,i,a.id)?(m.value=m.value.filter(r=>r.id!==a.id),f.success("删除成功")):f.error("删除失败")}})},z=()=>{T.value=!1},I=a=>new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(a));return(a,e)=>{const i=s("a-typography-title"),r=s("a-descriptions"),h=s("a-card"),b=s("icon-plus"),g=s("a-button"),C=s("a-space"),u=s("a-table-column"),F=s("a-table"),A=s("a-input"),V=s("a-form-item"),N=s("a-input-number"),E=s("a-form"),B=s("a-modal");return Y(),L("div",re,[t(i,{heading:3,style:{"margin-top":"0px","margin-bottom":"24px"}},{default:n(()=>e[4]||(e[4]=[y("票档管理")])),_:1}),t(h,{class:"info-card",style:{"margin-bottom":"16px"}},{title:n(()=>e[5]||(e[5]=[y("基本信息")])),default:n(()=>{var l;return[k("div",ie,[k("div",ue,[k("div",ce,[k("img",{src:(l=c.value)==null?void 0:l.coverUrl,alt:"演出封面"},null,8,de)]),k("div",me,[t(r,{data:S.value,layout:"inline-horizontal",column:1},null,8,["data"])])]),k("div",pe,[t(r,{data:q.value,layout:"inline-horizontal",column:1},null,8,["data"])])])]}),_:1}),t(h,null,{title:n(()=>[t(C,null,{default:n(()=>[t(g,{type:"primary",onClick:P},{icon:n(()=>[t(b)]),default:n(()=>[e[6]||(e[6]=y(" 添加票档 "))]),_:1})]),_:1})]),default:n(()=>[t(F,{data:m.value,loading:w.value,pagination:!1,bordered:!1},{columns:n(()=>[t(u,{title:"票档ID","data-index":"id",width:85}),t(u,{title:"票档名称","data-index":"name",width:150}),t(u,{title:"票价",width:120},{cell:n(({record:l})=>[y(" ¥"+W(l.price),1)]),_:1}),t(u,{title:"总票数","data-index":"totalQuantity",width:150}),t(u,{title:"操作",width:150},{cell:n(({record:l})=>[t(g,{type:"text",size:"small",onClick:O=>R(l)},{default:n(()=>e[7]||(e[7]=[y(" 编辑 ")])),_:2},1032,["onClick"]),t(g,{type:"text",status:"danger",size:"small",onClick:O=>$(l)},{default:n(()=>e[8]||(e[8]=[y(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])]),_:1}),t(B,{visible:T.value,"onUpdate:visible":e[3]||(e[3]=l=>T.value=l),title:v.value?"编辑票档":"新增票档","on-before-ok":U,onCancel:z},{default:n(()=>[t(E,{ref_key:"ticketFormRef",ref:x,model:o,rules:M,"auto-label-width":""},{default:n(()=>[t(V,{field:"name",label:"票档名称",rules:[{required:!0,message:"请输入票档名称"}]},{default:n(()=>[t(A,{modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l),placeholder:"请输入票档名称","allow-clear":""},null,8,["modelValue"])]),_:1}),t(V,{field:"price",label:"票价",rules:[{required:!0,message:"请输入票价"}]},{default:n(()=>[t(N,{modelValue:o.price,"onUpdate:modelValue":e[1]||(e[1]=l=>o.price=l),min:0,precision:2,placeholder:"请输入票价"},null,8,["modelValue"])]),_:1}),t(V,{field:"totalQuantity",label:"总票数",rules:[{required:!0,message:"请输入总票数"}]},{default:n(()=>[t(N,{modelValue:o.totalQuantity,"onUpdate:modelValue":e[2]||(e[2]=l=>o.totalQuantity=l),min:1,precision:0,placeholder:"请输入总票数"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),ye=Z(fe,[["__scopeId","data-v-fcc809ec"]]);export{ye as default};
