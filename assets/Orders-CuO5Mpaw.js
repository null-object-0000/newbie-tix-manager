import{o as H,g as I,j as V,k as C}from"./api-rjBpfQPZ.js";import{d as J,r as f,g as K,c as S,a as n,w as o,b as i,M as Q,e as u,F as W,p as X,t as c,n as d,y as Y,z as Z,o as x,_ as tt}from"./index-IoAneAfo.js";const et={class:"container"},at={class:"text-gray-500 text-sm"},lt={class:"text-gray-500 text-sm"},ot={class:"text-gray-500 text-sm"},nt=J({__name:"Orders",setup(st){const m=e=>{if(!e)return"-";const t=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(t)},g=f(!1),v=f([]),s=K({orderNo:"",status:"",time:[]}),F=[{label:"待支付",value:"pending"},{label:"已支付",value:"paid"},{label:"已取消",value:"cancelled"}],D=[{title:"订单编号",dataIndex:"orderNo",width:180},{title:"演出信息",slotName:"performance"},{title:"票档信息",slotName:"ticket"},{title:"订单金额",slotName:"amount",width:160},{title:"下单时间",dataIndex:"createTime",width:180,render:(e,t)=>m(t.createTime)},{title:"状态",slotName:"status",width:100},{title:"操作",slotName:"actions",width:160}],M=async e=>{try{const t=await I(e);return(t==null?void 0:t.title)||"-"}catch(t){return console.error("Failed to get performance:",t),"-"}},O=async(e,t)=>{try{const l=await V(e,t);return(l==null?void 0:l.title)||m((l==null?void 0:l.startShowTime)||"")}catch(l){return console.error("Failed to get session:",l),"-"}},z=async(e,t,l)=>{try{const r=(await C(e,t)).find(_=>_.id===l);return(r==null?void 0:r.title)||"-"}catch(p){return console.error("Failed to get ticket:",p),"-"}},A=e=>({pending:"orange",paid:"green",cancelled:"red"})[e]||"default",h=e=>({pending:"待支付",paid:"已支付",cancelled:"已取消"})[e]||e,y=async()=>{var e,t;g.value=!0;try{const l=await H({orderNo:s.orderNo,status:s.status,startTime:(e=s.time)==null?void 0:e[0],endTime:(t=s.time)==null?void 0:t[1]});v.value=l}catch(l){Q.error("获取订单数据失败"),console.error("Failed to load orders:",l),v.value=[]}finally{g.value=!1}},B=async()=>{await y()},P=async()=>{s.orderNo="",s.status="",s.time=[],await y()},w=f(!1),b=f(null),N=f(),U=async e=>{if(b.value=e,!b.value)return[];const t=await I(e.performanceId),l=await V(e.performanceId,e.sessionId),r=(await C(e.performanceId,e.sessionId)).find(_=>_.id===e.ticketId);N.value=[{label:"订单编号",value:e.orderNo},{label:"下单时间",value:m(e.createTime)},{label:"支付时间",value:e.payTime?m(e.payTime):"-"},{label:"订单状态",value:h(e.status)},{label:"演出标题",value:(t==null?void 0:t.title)||"-"},{label:"场次信息",value:(l==null?void 0:l.title)||m((l==null?void 0:l.startShowTime)||"")},{label:"票档信息",value:(r==null?void 0:r.title)||"-"},{label:"票价",value:`¥${e.price}`},{label:"数量",value:e.quantity},{label:"票面总价",value:`¥${e.totalAmount}`},{label:"实付金额",value:`¥${e.finalAmount}`}],w.value=!0};return y(),(e,t)=>{const l=i("a-typography-title"),p=i("a-input"),r=i("a-form-item"),_=i("a-option"),$=i("a-select"),q=i("a-range-picker"),k=i("a-button"),T=i("a-space"),j=i("a-form"),E=i("a-tag"),L=i("a-table"),R=i("a-descriptions"),G=i("a-drawer");return x(),S("div",et,[n(l,{heading:3,style:{"margin-top":"0px","margin-bottom":"24px"}},{default:o(()=>t[4]||(t[4]=[u("订单管理")])),_:1}),n(j,{model:s,class:"filter-form",layout:"inline"},{default:o(()=>[n(r,{field:"orderNo",label:"订单编号"},{default:o(()=>[n(p,{modelValue:s.orderNo,"onUpdate:modelValue":t[0]||(t[0]=a=>s.orderNo=a),placeholder:"请输入订单编号","allow-clear":""},null,8,["modelValue"])]),_:1}),n(r,{field:"status",label:"订单状态"},{default:o(()=>[n($,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=a=>s.status=a),placeholder:"请选择订单状态","allow-clear":""},{default:o(()=>[(x(),S(W,null,X(F,a=>n(_,{key:a.value,value:a.value},{default:o(()=>[u(c(a.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(r,{field:"time",label:"下单时间"},{default:o(()=>[n(q,{modelValue:s.time,"onUpdate:modelValue":t[2]||(t[2]=a=>s.time=a),style:{width:"260px"},"allow-clear":""},null,8,["modelValue"])]),_:1}),n(r,null,{default:o(()=>[n(T,null,{default:o(()=>[n(k,{type:"primary",onClick:B},{default:o(()=>t[5]||(t[5]=[u("搜索")])),_:1}),n(k,{onClick:P},{default:o(()=>t[6]||(t[6]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),n(L,{loading:g.value,data:v.value,columns:D,pagination:{total:v.value.length,pageSize:10,showTotal:!0,showPageSize:!0},class:"mt-4"},{performance:o(({record:a})=>[d("div",null,c(M(a.performanceId)),1),d("div",at,c(O(a.performanceId,a.sessionId)),1)]),ticket:o(({record:a})=>[d("div",null,c(z(a.performanceId,a.sessionId,a.ticketId)),1),d("div",lt,"¥"+c(a.price)+" × "+c(a.quantity),1)]),amount:o(({record:a})=>[d("div",null,"票面总价：¥"+c(a.totalAmount),1),d("div",ot,"实付金额：¥"+c(a.finalAmount),1)]),status:o(({record:a})=>[n(E,{color:A(a.status)},{default:o(()=>[u(c(h(a.status)),1)]),_:2},1032,["color"])]),actions:o(({record:a})=>[n(T,null,{default:o(()=>[n(k,{type:"text",size:"small",onClick:it=>U(a)},{default:o(()=>t[7]||(t[7]=[u(" 查看 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["loading","data","pagination"]),n(G,{visible:w.value,"onUpdate:visible":t[3]||(t[3]=a=>w.value=a),width:600,title:"订单详情"},{default:o(()=>[b.value?(x(),Y(R,{key:0,data:N.value,layout:"inline-vertical",bordered:""},null,8,["data"])):Z("",!0)]),_:1},8,["visible"])])}}}),ut=tt(nt,[["__scopeId","data-v-ec33d6ec"]]);export{ut as default};
