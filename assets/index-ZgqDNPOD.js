import{d as S,r as d,i as B,j as L,w as t,b as n,a as e,e as U,k as P,o as A,c as F,h as G,u as H,M as m,g,t as J,_ as K}from"./index-CX8KaRsY.js";const Q=S({__name:"TicketTierDialog",props:{visible:{type:Boolean},mode:{},ticketTierData:{}},emits:["update:visible","submit"],setup(h,{emit:w}){const p=h,v=w,_=d(),l=d({name:"",price:0,stock:0,...p.ticketTierData}),y=B(()=>({create:"新增票档",edit:"编辑票档",view:"查看票档"})[p.mode]),b=async()=>{var a;if(p.mode==="view"){v("update:visible",!1);return}await((a=_.value)==null?void 0:a.validate())&&v("submit",l.value)},u=()=>{v("update:visible",!1)};return(i,a)=>{const V=n("a-input"),k=n("a-form-item"),f=n("a-input-number"),x=n("a-form"),D=n("a-modal");return U(),L(D,{visible:i.visible,title:y.value,"onUpdate:visible":a[3]||(a[3]=s=>v("update:visible",s)),onOk:b,onCancel:u},{default:t(()=>[e(x,{ref_key:"formRef",ref:_,model:l.value},{default:t(()=>[e(k,{field:"name",label:"票档名称",rules:[{required:!0,message:"请输入票档名称"}]},{default:t(()=>[e(V,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value.name=s),placeholder:"请输入票档名称",disabled:i.mode==="view"},null,8,["modelValue","disabled"])]),_:1}),e(k,{field:"price",label:"票价",rules:[{required:!0,message:"请输入票价"}]},{default:t(()=>[e(f,{modelValue:l.value.price,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.price=s),placeholder:"请输入票价",min:0,precision:2,disabled:i.mode==="view"},null,8,["modelValue","disabled"])]),_:1}),e(k,{field:"stock",label:"库存数量",rules:[{required:!0,message:"请输入库存数量"}]},{default:t(()=>[e(f,{modelValue:l.value.stock,"onUpdate:modelValue":a[2]||(a[2]=s=>l.value.stock=s),placeholder:"请输入库存数量",min:0,precision:0,disabled:i.mode==="view"},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])}}}),W={class:"session-detail"},X=S({__name:"index",setup(h){const w=H(),p=P(),v=p.params.id,_=p.params.sessionId,l=d({id:"",showId:"",name:"",startTime:"",endTime:""}),y=d([]),b=d(!1),u=d(!1),i=d("create"),a=d({}),V=B(()=>[{label:"场次名称",value:l.value.name},{label:"开始时间",value:I(l.value.startTime)},{label:"结束时间",value:I(l.value.endTime)}]),k=async()=>{try{l.value={id:_,showId:v,name:"场次1",startTime:"2024-02-10 19:30:00",endTime:"2024-02-10 21:30:00"}}catch{m.error("获取场次详情失败")}},f=async()=>{b.value=!0;try{y.value=[{id:"1",sessionId:_,name:"VIP票",price:580,stock:100,sold:50,status:"available"}]}catch{m.error("获取票档列表失败")}finally{b.value=!1}},x=()=>{i.value="create",a.value={sessionId:_},u.value=!0},D=r=>{i.value="edit",a.value={...r},u.value=!0},s=async r=>{try{m.success("删除成功"),await f()}catch{m.error("删除失败")}},z=async r=>{try{i.value==="create"?m.success("创建票档成功"):m.success("更新票档成功"),u.value=!1,await f()}catch{m.error("操作失败")}},I=r=>new Date(r).toLocaleString("zh-CN");return A(()=>{k(),f()}),(r,o)=>{const R=n("icon-plus"),C=n("a-button"),$=n("a-page-header"),q=n("a-descriptions"),M=n("a-card"),T=n("a-table-column"),N=n("a-popconfirm"),O=n("a-space"),E=n("a-table");return U(),F("div",W,[e($,{title:l.value.name,onBack:o[0]||(o[0]=c=>G(w).back())},{extra:t(()=>[e(C,{onClick:x},{icon:t(()=>[e(R)]),default:t(()=>[o[2]||(o[2]=g(" 新增票档 "))]),_:1})]),_:1},8,["title"]),e(M,{class:"detail-card"},{default:t(()=>[e(q,{data:V.value,layout:"inline-horizontal",bordered:""},null,8,["data"])]),_:1}),e(M,{class:"ticket-tiers-card"},{title:t(()=>o[3]||(o[3]=[g("票档列表")])),default:t(()=>[e(E,{data:y.value,loading:b.value,pagination:!1},{columns:t(()=>[e(T,{title:"票档名称","data-index":"name"}),e(T,{title:"票价","data-index":"price"},{cell:t(({record:c})=>[g(J(c.price)+"元 ",1)]),_:1}),e(T,{title:"库存数量","data-index":"stock"}),e(T,{title:"已售数量","data-index":"sold"}),e(T,{title:"操作",fixed:"right",width:180},{cell:t(({record:c})=>[e(O,null,{default:t(()=>[e(C,{type:"text",size:"small",onClick:j=>D(c)},{default:t(()=>o[4]||(o[4]=[g("编辑")])),_:2},1032,["onClick"]),e(N,{content:"确定要删除该票档吗？",onOk:j=>s(c)},{default:t(()=>[e(C,{type:"text",size:"small",status:"danger"},{default:t(()=>o[5]||(o[5]=[g("删除")])),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading"])]),_:1}),e(Q,{visible:u.value,"onUpdate:visible":o[1]||(o[1]=c=>u.value=c),mode:i.value,"ticket-tier-data":a.value,onSubmit:z},null,8,["visible","mode","ticket-tier-data"])])}}}),Z=K(X,[["__scopeId","data-v-b378da16"]]);export{Z as default};
